.nav {
    z-index: 30;

    &.inverse:not(.page-open) {
        .logo, .logo-mobile, a {
            color: var(--dg-color-text-secondary--inverse);
        }
    }

    &.page-open {
        background-color: var(--dg-color-surface-primary)
    }

    &.nav-left {
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
    
        &.page-open {
            border-radius: 0 0 16px 0;
        }
    
        .icon {
            width: 48px;
            height: 48px;
    
            background-image: url(icon/logo-lens.svg);
        }
    
        .logo , .logo-mobile {
            color: var(--dg-color-text-secondary);
    
            h1, h2 {
                display: unset;
    
                font-size: 1.5rem;
                margin: 0;
                font-weight: bold;
            }
        }
    
        .logo-mobile {
            display: none;
        }
    }

    &.nav-right {
        position: fixed;
        top: 0;
        right: 0;
    
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 16px;
    
        &.page-open {
            border-radius: 0 0 0 16px;
        }
    
        a {
            font-size: 1.2rem;
            margin: 12px 0;
            font-weight: 600;
            color: var(--dg-color-text-secondary);
        }
    }
}

a, .nav-link {
    position: relative;
    cursor: pointer;
}

a:hover, .nav-link:hover, .logo h1:hover {
    color: var(--dg-color-text-primary);
}

.nav-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: currentColor;
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 10px;
}

.nav-link:hover::after , .nav-link.active::after{
    width: 100%;
}

.map-container {
    position: absolute;
    overflow-x: hidden;
    top: 0;
    bottom: 0;
    width: 100%;
    display: flex;

    &.mode-swipe {
        .map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;

            &#map-main, &#map-compare {
                border: none;
            }
        }
    }

    &.mode-split {
        #map-main {
            .mapboxgl-ctrl-bottom-right {
                display: none;
            }
        }

        #map-compare {
            .mapboxgl-ctrl-bottom-left {
                display: none;
            }
        }
    }

    .map {
        flex: 1;
    }

    #map-main {
        border-right: solid 1px #fff;
    }

    #map-compare {
        border-left: solid 1px #fff;
    }

    select {
        border: none;
        border-radius: 4px;
        width: 100%;

        padding: 2px;
        font-size: 1rem;
        font-family: Inter;

        background-color: var(--dg-color-surface-tertiary);
    }
}

.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl {
    margin: 0 0 8px 8px;
}

mapboxgl-ctrl-bottom-right {
    z-index: 100; /* Necessary for two-line credits to be over UI */
}

.mapboxgl-ctrl-attrib.mapboxgl-compact {
    margin-bottom: 6px;
}

.widget-container {
    display: flex;
    flex-direction: column;
    z-index: 10;
    gap: 16px;

    max-width: 45vw;

    position: absolute;

    bottom: 32px; /* Making room for Mapbox's credits */

    &.right-widget-container {
        right: 0;

        transform: translateX(100%);

        .surface {
            border-radius: 8px 0 0 8px;
        }
    }

    &.left-widget-container {
        width: 240px;
        left: 0;

        transform: translateX(-100%);

        .surface {
            border-radius: 0 8px 8px 0;
        }
    }

    .widget-toggle-container {
        position: absolute;
        padding: 6px;

        height: 80%;
        max-height: 48px;
        width: 24px;

        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;

        background-color: var(--dg-color-surface-secondary);
        opacity: 0.8;
    }
}

.surface {
    transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);

    &.surface-left {
        transform: translateX(100%);

        .widget-toggle-container {
            background-image: url(../assets/icon/chevron-left.svg);
            box-shadow: var(--elevation-100-right);
            right: -36px;
            border-radius: 0 4px 4px 0;
        }
    }

    &.surface-right {
        transform: translateX(-100%);

        .widget-toggle-container {
            background-image: url(../assets/icon/chevron-right.svg);
            box-shadow: var(--elevation-100-left);
            left: -36px;
            border-radius: 4px 0 0 4px;
        }
    }

    &.collapsed {
        transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);

        div {
            opacity: 0;
        }

        &.surface-left {
            transform: translateX(0);

            .widget-toggle-container {
                background-image: url(../assets/icon/chevron-right.svg);
            }
        }

        &.surface-right {
            transform: translateX(0);

            .widget-toggle-container {
                background-image: url(../assets/icon/chevron-left.svg);
            }
        }

        &.mode-selector .widget-toggle-container {
            background-image: url(../assets/icon/sidebar.svg);
        }

        &.basemap-selector .widget-toggle-container {
            background-image: url(../assets/icon/map.svg);
        }

        &.legend .widget-toggle-container {
            background-image: url(../assets/icon/list.svg);
        }

        &.dataset-selector .widget-toggle-container {
            background-image: url(../assets/icon/settings.svg);
        }
    }
}

.wee-map-popup {
    min-width: 280px;
    font-size: 1rem;

    .mapboxgl-popup-content {

        >div {
            display: flex;
            flex-direction: column;
            gap: 8px;
            
            .popup-row {
                display: flex;
                flex-direction: row;
                gap: 8px;

                justify-content: space-between;
            }
    
            .row-label {
                font-weight: bold;
            }

            .row-value {
                text-align: end;
            }
        }

        hr {
            width: 100%;
            color: var(--dg-color-border-primary);
            margin: 0;
        }

        .mapboxgl-popup-close-button {
            top: 6px;
            right: 6px;
            font-size: 1.5rem;
            border-radius: 2px;
        }
    }
}

.widget-selector-header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;

    column-gap: 16px;
    padding: 0.5rem 1rem;
    
    border-radius: 0 0 0 8px;

    .widget-selector-title {
        font-weight: bold;
    }

    .widget-selector-dropdown select {
        background-color: var(--dg-color-surface-secondary);
    }
}

.basemap-selector {
    .widget-selector-header {
        padding: 8px;
    }

    .widget-toggle-container {
        max-height: 36px;
    }
}

.selector-row {
    display: flex;
    flex-direction: row;
    align-items: center;

    overflow: hidden;
    border-radius: 8px 0 0 0;

    .selector-row-item {
        cursor: pointer;

        padding: 8px;
        flex-grow: 1;
        text-align: center;

        &.selected {
            background-color: var(--dg-color-surface-primary--selected);
            font-weight: bold;            
        }
    }
}

.dataset-selector, .mode-selector {
    display: flex;
    flex-direction: column;
    padding: 0;

    .widget-selector-header {
        background-color: var(--dg-color-surface-secondary);

        select {
            background-color: var(--dg-color-surface-tertiary);
        }
    }
}

.dataset-selector {
    &.hidden {
        display: none;
    }
}

.mode-selector {

    .selector-row {
        border-radius: unset;
    }

    .mode-control {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;

        overflow: hidden;
        border-radius: 0 8px 0 0;

        padding: 8px 16px;
        gap: 16px;

        background-color: var(--dg-color-surface-secondary);

        &.control-timeline {
            font-size: 1.2rem;
        }

        select {
            background-color: var(--dg-color-surface-tertiary);
        }

        .swap-years {
            cursor: pointer;
            width: 64px;
            height: 24px;

            background-image: url(../assets/icon/swap.svg);
        }
    }
}

.legend {
    padding: 0;

    
    &.legend-compare .legend-content-wrapper {
        grid-template-columns: 1fr auto auto;

        .legend-row, .legend-row.total-row {
            grid-column: span 3;
        }
    }
}

.legend-content-wrapper { 
    font-size: 1rem;
    padding: 0 0.5rem;

    max-height: 35vh; 
    border-radius: 8px 0 0 8px;

    overflow-y: auto;

    scrollbar-width: thin; /* For Firefox */
    scrollbar-color: rgba(155, 155, 155, 0.7) transparent; /* For Firefox */
    
    /* For Chrome, Safari, and Opera */
    &::-webkit-scrollbar {
        width: 12px;
    }

    &::-webkit-scrollbar-track {
        background: transparent;
    }

    &::-webkit-scrollbar-thumb {
        background-color: rgba(155, 155, 155, 0.7);
        border-radius: 20px;
        border: 3px solid transparent;
        background-clip: content-box;
    }

    display: grid;
    grid-template-columns: 1fr auto;
    column-gap: 1rem;

    span.status {
        border-radius: 50%;
        display: inline-block;
        height: 10px;
        margin-right: 6px;
        width: 10px;
    }

    .legend-content {
        display: contents;

        padding: 8px 16px 8px 16px;
        margin: -4px -8px 0 -8px;
    }

    .legend-row {
        display: grid;
        grid-template-columns: subgrid;
        grid-column: span 2;

        position: relative;

        padding: 4px 8px;
        gap: 16px;

        &.feature-row {
            padding: 4px 8px;
            margin-bottom: 4px;

            &:hover {
                border-radius: 4px;
                cursor: pointer;
                background-color: var(--dg-color-surface-secondary);
            }

            &.loading:not(.disabled)::before {
                content: "";
                position: absolute;
                left: 3px;
                width: 20px;
                height: 20px;
                align-self: center;
                background: url(../assets/icon/spinner.svg) no-repeat center center;
                background-size: contain;
                animation: spin 2s linear infinite;
            }
            
            &.loading:not(.disabled) {
                color: var(--dg-color-text--disabled);
            
                .value, .value.value-loss[class*="characteristic"], .value.value-growth[class*="characteristic"]{
                    color: var(--dg-color-text--disabled);
                }

                .label {
                    margin-left: 20px;
                }
            
                .status {
                    display: none;
                }
            }

            &.disabled {
                .label, .value, .value.value-loss[class*="characteristic"], .value.value-growth[class*="characteristic"] {
                    color: var(--dg-color-text--disabled);
                    background-color: var(--dg-color-surface--disabled);
                    
                    .status {
                        opacity: 0.5;
                    }
                }
            }
        }

        &.header-row {
            position: sticky;
            top: 0;
            padding: 12px 8px 8px 8px;
            z-index: 11;
            background-color: var(--dg-color-surface-primary);

            font-weight: bold;
        }

        &.total-row {
            position: sticky;
            bottom: 0;

            display: grid;
            grid-template-columns: subgrid;
            grid-column: span 2;
            
            padding: 10px 16px 10px 13px;
            margin: 0 -8px 0 -8px;
            background-color: var(--dg-color-surface-secondary);
            
            &.loading::before {
                left: 10px;
            }

            .label {
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .value {
                font-weight: bold;
            }

            .value.value-loss, .value.value-growth {
                &.characteristic-desirable {
                    color: var(--dg-color-text-success);
                }
                .characteristic-undesirable {
                    color: var(--dg-color-text-danger);
                }
            }

            .icon-advanced-toggle {
                display: inline-block;
                height: 16px;
                width: 16px;

                cursor: pointer;

                background-image: url(../assets/icon/settings.svg);
            }
        }

        .label {
            text-align: left;
            font-weight: bold;
        }

        .value {
            display: flex;
            align-items: center;
            text-align: right;

            &:first-of-type {
                justify-self: end;
            }

            &.value-loss, &.value-growth {
                text-align: left
            }
            
            &.value-loss {
                color: var(--dg-color-text-danger);

                &.characteristic-desirable {
                    color: var(--dg-color-text-danger);
                }

                &.characteristic-undesirable {
                    color: var(--dg-color-text-success);
                }

                &.characteristic-unclear {
                    color: var(--dg-color-text-warning);
                }
            }

            &.value-growth {
                color: var(--dg-color-text-success);

                &.characteristic-desirable {
                    color: var(--dg-color-text-success);
                }

                &.characteristic-undesirable {
                    color: var(--dg-color-text-danger);
                }

                &.characteristic-unclear {
                    color: var(--dg-color-text-warning);
                }
            }

            .value-indicator {
                font-size: 0.7rem;
                margin-right: 4px;
            }
        }
    }
}

.map-credit {
    position: fixed;
    bottom: 16px;
    left: 50%;
    transform: translate(-50%, -50%);

    opacity: 0.5;

    background: none;
    padding: 0;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Mapbox credits collapsing */
@media screen and (max-width: 1340px){
    .map-credit {
        bottom: 0;
    }
}

@media screen and (max-width: 767px) {
    .widget-container {
        max-width: 75vw;
    }

    .legend {

        .legend-content-wrapper {
            font-size: 0.8rem;
            column-gap: 0.25rem;
        }
    }
}

@media screen and (max-width: 575px) {
    .nav {
        padding: 6px 8px;

        &.nav-left {
            gap: 4px;
            
            .icon {
                width: 32px;
                height: 32px;
            }

            .logo {
                display: none;
            }

            .logo-mobile {
                display: unset;

                * {
                    font-size: 1.2rem;
                }
            }
        }

        &.nav-right {
            gap: 12px;

            .nav-link {
                margin: 4px 0;
            }
        }
    }


    .legend {

        .legend-content-wrapper {
            font-size: 0.8rem;
            column-gap: 0.25rem;
        }
    }
}